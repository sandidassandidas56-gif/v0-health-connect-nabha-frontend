"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[843],{29843:function(e,t,a){a.r(t),a.d(t,{default:function(){return l}});var n=a(57437),i=a(2265),s=a(68680),c=a(62869);function l(e){let{roomId:t,open:a,onClose:l}=e,r=(0,i.useRef)(null),o=(0,i.useRef)(null),[d,u]=(0,i.useState)(null),[f,w]=(0,i.useState)(null),[m,h]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{if(!a)return;let e=(0,s.ZP)("http://localhost:5000");return u(e),e.emit("join-room",t),()=>{e.disconnect()}},[a,t]),(0,i.useEffect)(()=>{let e,n;if(d&&a)return w(e=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]})),navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(t=>{n=t,r.current&&(r.current.srcObject=t,r.current.play()),t.getTracks().forEach(a=>e.addTrack(a,t)),h(!0)}),e.ontrack=e=>{o.current&&(o.current.srcObject=e.streams[0],o.current.play())},e.onicecandidate=e=>{e.candidate&&d&&d.emit("signal",{roomId:t,data:{candidate:e.candidate}})},d.on("signal",async a=>{let{data:n}=a;if(n.offer){await e.setRemoteDescription(new RTCSessionDescription(n.offer));let a=await e.createAnswer();await e.setLocalDescription(a),d.emit("signal",{roomId:t,data:{answer:a}})}else if(n.answer)await e.setRemoteDescription(new RTCSessionDescription(n.answer));else if(n.candidate)try{await e.addIceCandidate(new RTCIceCandidate(n.candidate))}catch(e){}}),d.on("user-joined",async()=>{let a=await e.createOffer();await e.setLocalDescription(a),d.emit("signal",{roomId:t,data:{offer:a}})}),()=>{n&&n.getTracks().forEach(e=>e.stop()),e.close()}},[d,a,t]),a)?(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xl flex flex-col items-center",children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Video Call (WebRTC)"}),(0,n.jsx)("video",{ref:r,autoPlay:!0,playsInline:!0,className:"w-full h-48 bg-black rounded mb-2"}),(0,n.jsx)("video",{ref:o,autoPlay:!0,playsInline:!0,className:"w-full h-48 bg-black rounded mb-2"}),(0,n.jsx)(c.z,{variant:"destructive",onClick:l,children:"End Call"})]})}):null}}}]);